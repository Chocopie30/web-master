<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EMP 데이터 목록</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous">
  </script>
</head>

<body>
  <h3>EMP 데이터 목록</h3>
  <table class="table">
    <thead>
      <tr>
        <th>사번</th>
        <th>이름</th>
        <th>직무</th>
        <th>급여</th>
      </tr>
    </thead>
    <tbody id="list">

    </tbody>
  </table>
  <script>
    // http://localhost:3000/emp => json데이터
    fetch('http://localhost:3000/emp')
      .then(rep => rep.json())
      .then(res => {
        console.log(res);
        res.forEach(item => {
          let tr = makeRow(item);
          document.querySelector('#list').appendChild(tr);
        })

      })
      .catch(err => console.log(err));

    function makeRow(employee) {
      let fields = ['EMPNO', 'ENAME', 'JOB', 'SAL'];

      let tr = document.createElement('tr');
      tr.setAttribute('data-eno', employee.EMPNO);
      fields.forEach(item => {
        let td = document.createElement('td');
        td.innerHTML = employee[item];
        tr.appendChild(td);
      });
      //삭제버튼
      let btn = document.createElement('button');
      btn.innerHTML = '삭제';
      btn.addEventListener('click', deleteFunc);
      let td = document.createElement('td');
      td.appendChild(btn);
      tr.appendChild(td);
      return tr;
    };

    function deleteFunc() {
      let thisTr = this.parentElement.parentElement;
      let eno = this.parentElement.parentElement.dataset.eno; //data-가 dataset에 들어감
      fetch('http://localhost:3000/emp/' + eno)
        .then(rep => rep.json())
        .then(res => {
          if (res.rowsAffected) {
            alert('성공');
            thisTr.remove();
          } else {
            alert('실패');
          }
        })
        .catch(err => console.log(err));
    };
  </script>
</body>

</html>